<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Stock-beta2 by tyfalk</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Stock-beta2</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/tyfalk/Stock-Beta2" class="btn">View on GitHub</a>
      <a href="https://github.com/tyfalk/Stock-Beta2/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/tyfalk/Stock-Beta2/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>library(quantmod)
library(ggplot2)</p>

<p>ui &lt;- fluidPage(
  titlePanel("CAPM for Desired Stock"),</p>

<p>sidebarLayout(
    sidebarPanel(color = 'cadetblue4',
                 helpText("Input a ticker and see the stock's regression to market and expected return."),</p>

<pre><code>             textInput("symb", label = h4("Input a Valid Stock Ticker"), value = "GE"),
             textInput("symb2", label = h4("Input a Valid Stock Ticker"), value = "XOM"),
             dateRangeInput("date", label = h4("Input Date Range for Returns"), start = '2007-01-01', end = as.character(Sys.Date())),
             helpText("Date Format: [YYYY/MM/DD]")
),

mainPanel(
  tabsetPanel(
    tabPanel("Market Regression", plotOutput("plot"),h4(textOutput('beta'))),
    tabPanel("Expected Return",  plotOutput("SML"), textOutput("eRmath"), helpText("[eR = rF + Beta(mR - rF)]"))

  )
))
</code></pre>

<p>)</p>

<p>server &lt;- function(input, output) {
  dataInput &lt;- reactive({
    validate(
      need(input$symb != "", "Please type a ticker"),
      need(input$date[1] &lt; input$date[2], 'Start date is either missing or is later than end date.')
    )</p>

<pre><code>options(download.file.method="wininet")
prices &lt;- getSymbols(input$symb, from = input$date[1], to = input$date[2], auto.assign = FALSE)
prices2 &lt;- getSymbols(input$symb2, from = input$date[1], to = input$date[2], auto.assign = FALSE)
market &lt;- getSymbols("^GSPC", from = input$date[1], to = input$date[2], auto.assign = FALSE)
t &lt;- getSymbols.FRED("TB1YR", auto.assign = FALSE)
dataPrices &lt;- merge.xts(Ad(prices), Ad(market), Ad(prices2), join = "inner")

stock &lt;- dataPrices[,1]
mm &lt;- dataPrices [,2]
sReturns &lt;- Delt(stock)[-1]
mmReturns &lt;- Delt(mm)[-1]
reg &lt;- lm((sReturns) ~ (mmReturns))



stock2 &lt;- dataPrices[,3]
sReturns2 &lt;- Delt(stock2)[-1]
reg2 &lt;- lm((sReturns2) ~ (mmReturns))




rMM &lt;- mean(mmReturns)*365
rF &lt;- as.vector(t[length(t)])/100
rI &lt;- rF +  reg$coefficients[2] * (rMM - rF)
theData &lt;- list(x = data.frame(cbind(as.vector(sReturns), as.vector(mmReturns), as.vector(sReturns2))), y = reg, z = rI[length(rI)], rF = rF, rMM = rMM, reg2 = reg2)
</code></pre>

<p>})</p>

<p>output$plot &lt;- renderPlot({</p>

<pre><code>theData &lt;- dataInput()
qplot(theData$x[,2], theData$x[,1], ylab = "Asset Returns", xlab = "Market Returns") +    
  geom_abline(intercept =theData$y$coef[1], slope = theData$y$coef[2], color = "grey23") +
  geom_abline(intercept =theData$reg2$coef[1], slope = theData$reg2$coef[2], color = "green") +
  labs(title = "Market Regression")+
  geom_point(color = "cadetblue4") 
</code></pre>

<p>})</p>

<p>output$eRmath &lt;- renderText({
    theData &lt;- dataInput()
    return(paste("Expected Return:", round(theData$z<em>100, 2), "%", " = ", round(theData$rF</em>100, 2), "%", "+", round(theData$y$coefficients[2], 2), "(", round(100<em>theData$rMM,2), "%", "-", round(theData$rF</em>100, 2), "%",")"))
  })</p>

<p>output$SML &lt;- renderPlot({
    theData &lt;- dataInput()
    qplot(theData$y$coef[2], theData$z, ylim = c(0, .15), xlim = c(0, 2), ylab = "Expected Return", xlab = "Beta") +
      geom_abline(intercept =theData$rF, slope = ((theData$z - theData$rF)/theData$y$coef[2])) +
      labs(title = "Security Market Line") +
      geom_point(color = "cadetblue4", size = 3.5)</p>

<p>})</p>

<p>output$beta &lt;- renderText({
    theData &lt;- dataInput()
    paste("    Beta:  ", round(theData$y$coef[2], 2))</p>

<p>})
}</p>

<p>shinyApp(ui = ui, server = server)</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/tyfalk/Stock-Beta2">Stock-beta2</a> is maintained by <a href="https://github.com/tyfalk">tyfalk</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
